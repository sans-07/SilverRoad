<!DOCTYPE html>
<html>

<head>
  <title>위치 기록 + 지도 시각화 + DB 연동</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 80vh;
    }

    #ansim-view,
    #guardian-view {
      display: none;
      padding: 15px;
    }

    #connection-management,
    #connection-requests,
    #connected-ansims,
    #alerts {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 5px;
    }

    #guardian-email-input {
      margin-right: 10px;
    }

    #guardian-map {
      height: 400px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <div style="padding: 10px; background: #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
    <h2 style="margin: 0;">내 위치 기록 + 시각화</h2>
    <div>
      <span id="user-email" style="margin-right: 15px;"></span>
      <button id="logout">로그아웃</button>
    </div>
  </div>

  <!-- 안심이용 화면 -->
  <div id="ansim-view">
    <button id="start">수집 시작</button>
    <button id="stop">수집 중지</button>
    <button id="download">CSV 다운로드</button>
    <p id="status">상태: 대기 중</p>
    <div id="map"></div>

    <hr>
    <div id="connection-management">
      <h4>보호자 연결 관리</h4>
      <p>상태: <span id="connection-status">연결되지 않음</span></p>
      <input type="email" id="guardian-email-input" placeholder="보호자 이메일 입력" />
      <button id="send-request-btn">연결 요청 보내기</button>
    </div>
  </div>

  <!-- 보호자용 화면 -->
  <div id="guardian-view">
    <h3>보호자 대시보드</h3>
    <p>연결된 안심이의 상태를 확인합니다.</p>

    <div id="connection-requests">
      <h4>새로운 연결 요청</h4>
      <div id="requests-list">
        <!-- 요청을 여기에 동적으로 추가 -->
      </div>
    </div>

    <hr>

    <div id="connected-ansims">
      <h4>연결된 안심이 목록</h4>
      <div id="ansim-list">
        <!-- 연결된 안심이 목록이 여기에 동적으로 추가 -->
      </div>
    </div>

    <hr>

    <div id="alerts">
      <h4>새로운 알림 (안심존 이탈)</h4>
      <div id="guardian-map"></div>
      <div id="alerts-list">
        <!-- 알림을 여기에 동적으로 추가 -->
      </div>
    </div>
  </div>



  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>


  <script type="module" src="js/collection.js" defer></script>
</body>

</html>